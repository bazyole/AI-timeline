<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Coding Benchmark</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600;700&family=IBM+Plex+Mono:wght@400;500&family=Playfair+Display:ital,wght@0,600;1,600&display=swap');
        
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #141414;
            --accent-coral: #ff6b6b;
            --accent-gold: #ffd93d;
            --accent-cyan: #6bcf7f;
            --accent-purple: #a855f7;
            --accent-blue: #339af0;
            --accent-pink: #ff8cc8;
            --text-primary: #f5f5f5;
            --text-secondary: #888;
            --text-muted: #555;
            --border: #2a2a2a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Space Grotesk', sans-serif;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            z-index: 1000;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }
        
        header {
            padding: 4rem 2rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
            border-bottom: 1px solid var(--border);
        }
        
        h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2.5rem, 8vw, 4.5rem);
            font-weight: 600;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #fff 0%, var(--text-secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .controls {
            display: flex;
            gap: 0.6rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
            padding: 1.1rem;
            background: rgba(255,255,255,0.015);
            border: 1px solid var(--border);
        }

        .controls-block {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            width: 100%;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            align-items: center;
        }

        .control-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
        }

        .control-input {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.62rem;
            padding: 0.3rem 0.5rem;
        }

        .control-btn {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.6rem;
            padding: 0.35rem 0.7rem;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            transition: all 0.2s ease;
        }

        .control-btn:hover {
            border-color: var(--text-primary);
            color: var(--text-primary);
        }
        
        .filter-btn {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.6rem;
            padding: 0.4rem 0.8rem;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.25s ease;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }
        
        .filter-btn:hover {
            border-color: var(--text-primary);
            color: var(--text-primary);
            transform: translateY(-1px);
        }
        
        .filter-btn.active {
            background: var(--text-primary);
            color: var(--bg-primary);
            border-color: var(--text-primary);
        }
        
        .chart-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 2px;
            padding: 2rem;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 2rem;
            align-items: stretch;
        }
        
        .chart-wrapper {
            position: relative;
            width: 100%;
            aspect-ratio: 4 / 3;
            max-height: 520px;
            flex: 1 1 0;
        }
        
        .legend-custom {
            display: flex;
            flex-direction: column;
            flex-wrap: nowrap;
            gap: 1rem;
            margin-top: 0;
            padding-top: 0;
            padding-left: 1.6rem;
            border-left: 1px solid var(--border);
            min-width: 200px;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            cursor: pointer;
            opacity: 0.75;
            transition: opacity 0.2s ease;
        }
        
        .legend-item:hover {
            opacity: 1;
        }
        
        .legend-item.inactive {
            opacity: 0.2;
        }
        
        .legend-dot {
            width: 8px;
            height: 8px;
            transform: rotate(45deg);
        }
        
        .legend-text {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-top: 3rem;
        }
        
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            border-color: var(--text-muted);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
        }
        
        .stat-card:nth-child(1)::before { background: var(--accent-coral); }
        .stat-card:nth-child(2)::before { background: var(--accent-gold); }
        .stat-card:nth-child(3)::before { background: var(--accent-cyan); }
        .stat-card:nth-child(4)::before { background: var(--accent-purple); }
        
        .stat-label {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.68rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 0.6rem;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: -0.03em;
        }
        
        .stat-meta {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.4rem;
        }
        
        footer {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            border-top: 1px solid var(--border);
            margin-top: 4rem;
        }
        
        @media (max-width: 768px) {
            header {
                padding: 3rem 1.5rem 1.5rem;
            }
            .container {
                padding: 1.5rem;
            }
            .chart-wrapper {
                aspect-ratio: 4 / 3;
                max-height: 420px;
            }
            .controls {
                justify-content: center;
                padding: 1rem;
            }
            .chart-container {
                padding: 1.2rem;
                flex-direction: column;
            }
            .legend-custom {
                padding-left: 0;
                padding-top: 1.4rem;
                border-left: none;
                border-top: 1px solid var(--border);
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Évolution des LLMs</h1>
        <p class="subtitle">Benchmark Coding • 2022–2026</p>
    </header>
    
    <div class="container">
        <div class="controls">
            <div class="controls-block">
                <div class="control-group">
                    <span class="control-label">Filtres</span>
                    <button class="filter-btn active" data-filter="all">Tous</button>
                    <button class="filter-btn" data-filter="openai">OpenAI</button>
                    <button class="filter-btn" data-filter="anthropic">Anthropic</button>
                    <button class="filter-btn" data-filter="google">Google</button>
                    <button class="filter-btn" data-filter="alibaba">Alibaba</button>
                    <button class="filter-btn" data-filter="deepseek">DeepSeek</button>
                    <button class="filter-btn" data-filter="meta">Meta</button>
                    <button class="filter-btn" data-filter="other">Autres</button>
                </div>
                <div class="control-group">
                    <span class="control-label">Zoom</span>
                    <button class="control-btn" id="zoomIn">Zoom +</button>
                    <button class="control-btn" id="zoomOut">Zoom -</button>
                    <button class="control-btn" id="resetZoom">Réinitialiser</button>
                </div>
            </div>
            <div class="controls-block">
                <div class="control-group">
                    <span class="control-label">Axe X</span>
                    <input class="control-input" type="date" id="xMin" aria-label="X minimum">
                    <input class="control-input" type="date" id="xMax" aria-label="X maximum">
                    <button class="control-btn" id="applyX">Appliquer</button>
                </div>
                <div class="control-group">
                    <span class="control-label">Période</span>
                    <button class="control-btn" data-range="90">3M</button>
                    <button class="control-btn" data-range="180">6M</button>
                    <button class="control-btn" data-range="365">1Y</button>
                    <button class="control-btn" data-range="730">2Y</button>
                    <button class="control-btn" data-range="1825">5Y</button>
                    <button class="control-btn" data-range="beginning">Beginning</button>
                </div>
                <div class="control-group">
                    <span class="control-label">Axe Y</span>
                    <input class="control-input" type="number" id="yMin" placeholder="min">
                    <input class="control-input" type="number" id="yMax" placeholder="max">
                    <button class="control-btn" id="applyY">Appliquer</button>
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="chart-wrapper">
                <canvas id="mainChart"></canvas>
            </div>
            <div class="legend-custom" id="customLegend"></div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Score Maximum</div>
                <div class="stat-value" id="highScore" style="color: var(--accent-coral)">—</div>
                <div class="stat-meta" id="highScoreModel"></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Progression Moyenne</div>
                <div class="stat-value" id="avgProgress" style="color: var(--accent-gold)">—</div>
                <div class="stat-meta">par an depuis 2022</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Modèles Analysés</div>
                <div class="stat-value" id="modelCount" style="color: var(--accent-cyan)">—</div>
                <div class="stat-meta">sur cette période</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Dernière Entrée</div>
                <div class="stat-value" style="color: var(--accent-purple)">Jan 26</div>
                <div class="stat-meta">Kimi K2.5</div>
            </div>
        </div>
    </div>
    
    <footer>
        Données compilées • Visualisation interactive
    </footer>

    <script>
        const rawData = [
            { model: "GPT-3.5", date: "2022-11-15", score: 923, vendor: "openai" },
            { model: "Mixtral 8×7B", date: "2023-12-15", score: 829, vendor: "mistral" },
            { model: "Mistral Large", date: "2024-02-15", score: 797, vendor: "mistral" },
            { model: "Llama 3", date: "2024-04-15", score: 894, vendor: "meta" },
            { model: "GPT-4o", date: "2024-05-13", score: 1137, vendor: "openai" },
            { model: "Claude 3.5 Sonnet", date: "2024-06-20", score: 1082, vendor: "anthropic" },
            { model: "Llama 3.1", date: "2024-07-15", score: 907, vendor: "meta" },
            { model: "Gemini 2.0 Flash", date: "2024-12-11", score: 1056, vendor: "google" },
            { model: "o1", date: "2024-12-15", score: 1081, vendor: "openai" },
            { model: "DeepSeek-V3", date: "2024-12-26", score: 1073, vendor: "deepseek" },
            { model: "DeepSeek-R1", date: "2025-01-20", score: 958, vendor: "deepseek" },
            { model: "Grok-3", date: "2025-02-15", score: 1151, vendor: "xai" },
            { model: "Claude 3.7 Sonnet", date: "2025-02-15", score: 1231, vendor: "anthropic" },
            { model: "QwQ-32B", date: "2025-03-15", score: 1064, vendor: "alibaba" },
            { model: "DeepSeek-V3-0324", date: "2025-03-24", score: 1129, vendor: "deepseek" },
            { model: "o3", date: "2025-04-16", score: 1075, vendor: "openai" },
            { model: "o4-mini-high", date: "2025-04-16", score: 1039, vendor: "openai" },
            { model: "GLM-4", date: "2025-04-15", score: 892, vendor: "zhipu" },
            { model: "Qwen3", date: "2025-04-28", score: 1282, vendor: "alibaba" },
            { model: "Claude Sonnet 4", date: "2025-05-15", score: 1203, vendor: "anthropic" },
            { model: "GPT-4.1", date: "2025-05-14", score: 1173, vendor: "openai" },
            { model: "o3-pro", date: "2025-06-15", score: 1148, vendor: "openai" },
            { model: "MiniMax-M1", date: "2025-06-17", score: 689, vendor: "minimax" },
            { model: "Gemini 2.5 Pro", date: "2025-06-17", score: 1228, vendor: "google" },
            { model: "Gemini 2.5 Flash", date: "2025-06-17", score: 1130, vendor: "google" },
            { model: "Grok-4", date: "2025-07-10", score: 1168, vendor: "xai" },
            { model: "Kimi K2", date: "2025-07-15", score: 1086, vendor: "moonshot" },
            { model: "GLM-4.5", date: "2025-07-28", score: 1114, vendor: "zhipu" },
            { model: "GPT-5", date: "2025-08-07", score: 1216, vendor: "openai" },
            { model: "DeepSeek-V3.1", date: "2025-08-21", score: 1100, vendor: "deepseek" },
            { model: "Qwen3-Max", date: "2025-09-15", score: 1242, vendor: "alibaba" },
            { model: "Claude Sonnet 4.5", date: "2025-09-15", score: 1326, vendor: "anthropic" },
            { model: "GLM-4.6", date: "2025-09-15", score: 1243, vendor: "zhipu" },
            { model: "DeepSeek-V3.2-Exp", date: "2025-09-29", score: 1154, vendor: "deepseek" },
            { model: "Claude Haiku 4.5", date: "2025-10-15", score: 1308, vendor: "anthropic" },
            { model: "MiniMax-M2", date: "2025-10-23", score: 1226, vendor: "minimax" },
            { model: "GPT-5.1", date: "2025-11-12", score: 1413, vendor: "openai" },
            { model: "Claude Opus 4.5", date: "2025-11-15", score: 1431, vendor: "anthropic" },
            { model: "Gemini 3 Pro", date: "2025-11-18", score: 1395, vendor: "google" },
            { model: "DeepSeek-V3.2", date: "2025-12-01", score: 1259, vendor: "deepseek" },
            { model: "GPT-5.2", date: "2025-12-11", score: 1368, vendor: "openai" },
            { model: "GLM-4.7", date: "2025-12-22", score: 1196, vendor: "zhipu" },
            { model: "Kimi K2.5", date: "2026-01-15", score: 1105, vendor: "moonshot" },
        ];

        const vendorColors = {
            openai: "#ffffff",
            anthropic: "#f97316",
            google: "#4285f4",
            alibaba: "#8b5cf6",
            deepseek: "#2563eb",
            meta: "#0866ff",
            xai: "#374151",
            mistral: "#ef4444",
            zhipu: "#06b6d4",
            minimax: "#ec4899",
            moonshot: "#fbbf24"
        };

        const vendorNames = {
            openai: "OpenAI",
            anthropic: "Anthropic",
            google: "Google",
            alibaba: "Qwen",
            deepseek: "DeepSeek",
            meta: "Meta",
            xai: "xAI",
            mistral: "Mistral",
            zhipu: "Zhipu",
            minimax: "MiniMax",
            moonshot: "Moonshot"
        };

        const vendorOrder = [
            "openai",
            "anthropic",
            "google",
            "xai",
            "alibaba",
            "deepseek",
            "moonshot",
            "zhipu",
            "minimax",
            "meta",
            "mistral"
        ];

        const filterMap = {
            all: null,
            openai: ["openai"],
            anthropic: ["anthropic"],
            google: ["google"],
            alibaba: ["alibaba"],
            deepseek: ["deepseek"],
            meta: ["meta"],
            other: ["xai", "mistral", "zhipu", "minimax", "moonshot"]
        };

        let chart;
        let activeFilter = "all";
        let hiddenVendors = new Set(["zhipu", "minimax", "meta", "mistral"]);
        let autoYEnabled = true;
        const ONE_DAY_MS = 24 * 60 * 60 * 1000;
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const defaultYMin = 950;
        const defaultYMax = 1450;
        const dateExtent = rawData.reduce((acc, item) => {
            const date = new Date(item.date);
            if (!acc.min || date < acc.min) acc.min = date;
            if (!acc.max || date > acc.max) acc.max = date;
            return acc;
        }, { min: null, max: null });
        const defaultXMin = new Date(today.getTime() - 365 * ONE_DAY_MS);
        const defaultXMax = new Date(today);

        function getFilteredData() {
            let data = rawData;
            if (filterMap[activeFilter]) {
                data = data.filter(d => filterMap[activeFilter].includes(d.vendor));
            }
            return data.filter(d => !hiddenVendors.has(d.vendor));
        }

        const iconCache = new Map();
        const logoCache = new Map();

        const vendorLogos = {
            openai: "https://github.com/openai.png",
            anthropic: "https://github.com/anthropics.png",
            google: "https://github.com/google.png",
            alibaba: "https://github.com/QwenLM.png",
            deepseek: "https://github.com/deepseek-ai.png",
            meta: "https://github.com/meta.png",
            mistral: "https://github.com/mistralai.png",
            zhipu: "https://github.com/THUDM.png",
            xai: "https://github.com/xai-org.png",
            minimax: "https://github.com/MiniMax-AI.png",
            moonshot: "https://github.com/MoonshotAI.png"
        };

        const vendorInitials = {
            openai: "O",
            anthropic: "A",
            google: "G",
            alibaba: "Q",
            deepseek: "D",
            meta: "M",
            xai: "X",
            mistral: "Mi",
            zhipu: "Z",
            minimax: "Mx",
            moonshot: "K"
        };

        function drawVendorIcon(ctx, size, color, image, initials) {
            ctx.clearRect(0, 0, size, size);
            ctx.fillStyle = '#0a0a0a';
            ctx.beginPath();
            ctx.arc(size / 2, size / 2, size / 2 - 2, 0, Math.PI * 2);
            ctx.fill();

            if (image && image.complete && image.naturalWidth && !image.dataset.failed) {
                ctx.save();
                ctx.beginPath();
                ctx.arc(size / 2, size / 2, size / 2 - 5, 0, Math.PI * 2);
                ctx.closePath();
                ctx.clip();
                ctx.drawImage(image, 4, 4, size - 8, size - 8);
                ctx.restore();
            } else if (initials) {
                ctx.fillStyle = '#f5f5f5';
                ctx.font = '600 10px "IBM Plex Mono", monospace';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(initials, size / 2, size / 2);
            }

            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(size / 2, size / 2, size / 2 - 2, 0, Math.PI * 2);
            ctx.stroke();
        }

        function getVendorLogo(vendor) {
            if (logoCache.has(vendor)) {
                return logoCache.get(vendor);
            }
            const image = new Image();
            image.src = vendorLogos[vendor];
            image.addEventListener('error', () => {
                image.dataset.failed = 'true';
                if (chart) {
                    chart.update('none');
                }
            });
            logoCache.set(vendor, image);
            return image;
        }

        function createVendorIcon(vendor, color) {
            const cacheKey = `${vendor}-${color}`;
            if (iconCache.has(cacheKey)) {
                return iconCache.get(cacheKey);
            }

            const canvas = document.createElement('canvas');
            const size = 26;
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');

            const image = getVendorLogo(vendor);
            drawVendorIcon(ctx, size, color, image, vendorInitials[vendor]);

            image.addEventListener('load', () => {
                drawVendorIcon(ctx, size, color, image, vendorInitials[vendor]);
                if (chart) {
                    chart.update('none');
                }
            });

            iconCache.set(cacheKey, canvas);
            return canvas;
        }

        function getGoogleGradient(ctx, chartArea) {
            if (!chartArea) {
                return vendorColors.google;
            }
            const gradient = ctx.createLinearGradient(chartArea.left, chartArea.top, chartArea.right, chartArea.bottom);
            gradient.addColorStop(0, "#4285f4");
            gradient.addColorStop(0.33, "#34a853");
            gradient.addColorStop(0.66, "#fbbc05");
            gradient.addColorStop(1, "#ea4335");
            return gradient;
        }

        function createDatasets(data) {
            const vendors = vendorOrder.filter(vendor => data.some(d => d.vendor === vendor));
            const vendorScores = new Map();
            vendors.forEach(vendor => {
                const vendorData = data
                    .filter(d => d.vendor === vendor)
                    .sort((a, b) => new Date(a.date) - new Date(b.date));
                vendorScores.set(vendor, vendorData[vendorData.length - 1]?.score ?? 0);
            });
            const orderedByScore = [...vendors].sort((a, b) => vendorScores.get(a) - vendorScores.get(b));
            const scoreOrderMap = new Map(orderedByScore.map((vendor, index) => [vendor, index]));

            return vendors.map(vendor => {
                const vendorData = data
                    .filter(d => d.vendor === vendor)
                    .sort((a, b) => new Date(a.date) - new Date(b.date));
                const highlightIndex = vendorData.length - 1;
                const hasGradient = vendor === "google";
                return {
                    label: vendorNames[vendor],
                    data: vendorData.map(d => ({
                        x: new Date(d.date),
                        y: d.score,
                        model: d.model
                    })),
                    backgroundColor: hasGradient
                        ? (context) => getGoogleGradient(context.chart.ctx, context.chart.chartArea)
                        : vendorColors[vendor],
                    borderColor: hasGradient
                        ? (context) => getGoogleGradient(context.chart.ctx, context.chart.chartArea)
                        : vendorColors[vendor],
                    pointBackgroundColor: hasGradient
                        ? (context) => getGoogleGradient(context.chart.ctx, context.chart.chartArea)
                        : vendorColors[vendor],
                    pointBorderColor: hasGradient
                        ? (context) => getGoogleGradient(context.chart.ctx, context.chart.chartArea)
                        : vendorColors[vendor],
                    pointRadius: (context) => (context.dataIndex === highlightIndex ? 13 : 7),
                    pointHoverRadius: (context) => (context.dataIndex === highlightIndex ? 15 : 10),
                    pointBorderWidth: (context) => (context.dataIndex === highlightIndex ? 4 : 2),
                    pointHitRadius: 14,
                    pointStyle: createVendorIcon(vendor, vendorColors[vendor]),
                    showLine: true,
                    borderWidth: 2,
                    tension: 0.2,
                    order: scoreOrderMap.get(vendor)
                };
            });
        }

        function updateStats(data) {
            const highest = data.reduce((a, b) => a.score > b.score ? a : b);
            document.getElementById('highScore').textContent = highest.score;
            document.getElementById('highScoreModel').textContent = highest.model;
            document.getElementById('modelCount').textContent = data.length;
            const avgProgress = Math.round((highest.score - 923) / 3.2);
            document.getElementById('avgProgress').textContent = `+${avgProgress}`;
        }

        function buildLegend() {
            const vendors = vendorOrder.filter(vendor => rawData.some(d => d.vendor === vendor));
            const container = document.getElementById('customLegend');
            container.innerHTML = '';
            
            vendors.forEach(vendor => {
                const item = document.createElement('div');
                item.className = `legend-item${hiddenVendors.has(vendor) ? ' inactive' : ''}`;
                item.innerHTML = `
                    <span class="legend-dot" style="background: ${vendorColors[vendor]}"></span>
                    <span class="legend-text">${vendorNames[vendor]}</span>
                `;
                item.addEventListener('click', () => {
                    if (hiddenVendors.has(vendor)) {
                        hiddenVendors.delete(vendor);
                    } else {
                        hiddenVendors.add(vendor);
                    }
                    updateChart();
                    buildLegend();
                });
                container.appendChild(item);
            });
        }

        function getYBounds(data) {
            if (!data.length) {
                return { min: defaultYMin, max: defaultYMax };
            }
            const scores = data.map(item => item.score);
            let min = Math.min(...scores);
            let max = Math.max(...scores);
            if (min === max) {
                min -= 20;
                max += 20;
            }
            const padding = (max - min) * 0.08;
            return {
                min: Math.max(0, Math.floor(min - padding)),
                max: Math.ceil(max + padding)
            };
        }

        function updateChart() {
            const data = getFilteredData();
            chart.data.datasets = createDatasets(data);
            if (autoYEnabled) {
                const bounds = getYBounds(data);
                chart.options.scales.y.min = bounds.min;
                chart.options.scales.y.max = bounds.max;
                setAxisInputs(
                    chart.options.scales.x.min || defaultXMin,
                    chart.options.scales.x.max || defaultXMax,
                    bounds.min,
                    bounds.max
                );
            }
            chart.update('none');
            updateStats(data);
        }

        function formatDateInput(date) {
            return date.toISOString().slice(0, 10);
        }

        function setAxisInputs(xMin = defaultXMin, xMax = defaultXMax, yMin = defaultYMin, yMax = defaultYMax) {
            const xMinInput = document.getElementById('xMin');
            const xMaxInput = document.getElementById('xMax');
            const yMinInput = document.getElementById('yMin');
            const yMaxInput = document.getElementById('yMax');

            xMinInput.value = formatDateInput(xMin);
            xMaxInput.value = formatDateInput(xMax);
            yMinInput.value = yMin;
            yMaxInput.value = yMax;
        }

        function applyAxisScale(axis) {
            if (!chart) return;
            if (axis === 'x') {
                const minValue = document.getElementById('xMin').value;
                const maxValue = document.getElementById('xMax').value;
                chart.options.scales.x.min = minValue ? new Date(minValue) : undefined;
                chart.options.scales.x.max = maxValue ? new Date(maxValue) : undefined;
            }
            if (axis === 'y') {
                const minValue = document.getElementById('yMin').value;
                const maxValue = document.getElementById('yMax').value;
                chart.options.scales.y.min = minValue ? Number(minValue) : undefined;
                chart.options.scales.y.max = maxValue ? Number(maxValue) : undefined;
                autoYEnabled = false;
            }
            chart.update('none');
        }

        function resetAxes() {
            chart.options.scales.x.min = defaultXMin;
            chart.options.scales.x.max = defaultXMax;
            chart.options.scales.y.min = defaultYMin;
            chart.options.scales.y.max = defaultYMax;
            autoYEnabled = true;
            setAxisInputs();
        }

        function applyDateRange(days) {
            const endDate = new Date(today);
            let startDate;
            if (days === 'beginning') {
                startDate = dateExtent.min;
                chart.options.scales.x.max = dateExtent.max;
            } else {
                const totalDays = Number(days);
                startDate = new Date(today.getTime() - totalDays * ONE_DAY_MS);
                chart.options.scales.x.max = endDate;
            }
            chart.options.scales.x.min = startDate;
            autoYEnabled = true;
            updateChart();
            setAxisInputs(startDate, chart.options.scales.x.max, chart.options.scales.y.min, chart.options.scales.y.max);
        }

        const modelLabelPlugin = {
            id: 'modelLabels',
            afterDatasetsDraw(chartInstance) {
                const { ctx } = chartInstance;
                ctx.save();
                ctx.font = '500 9px "IBM Plex Mono", monospace';
                ctx.fillStyle = 'rgba(245, 245, 245, 0.7)';
                ctx.textAlign = 'left';
                ctx.textBaseline = 'middle';

                chartInstance.data.datasets.forEach((dataset, datasetIndex) => {
                    const meta = chartInstance.getDatasetMeta(datasetIndex);
                    if (meta.hidden) return;
                    meta.data.forEach((element, index) => {
                        const pointData = dataset.data[index];
                        if (!pointData || !pointData.model) return;
                        const position = element.tooltipPosition();
                        ctx.fillText(pointData.model, position.x + 8, position.y - 8);
                    });
                });

                ctx.restore();
            }
        };

        const latestModelHighlightPlugin = {
            id: 'latestModelHighlight',
            afterDatasetsDraw(chartInstance) {
                const { ctx } = chartInstance;
                ctx.save();
                chartInstance.data.datasets.forEach((dataset, datasetIndex) => {
                    const meta = chartInstance.getDatasetMeta(datasetIndex);
                    if (meta.hidden) return;
                    const lastIndex = dataset.data.length - 1;
                    const point = meta.data[lastIndex];
                    if (!point) return;
                    const position = point.tooltipPosition();
                    const baseRadius = point.options?.radius || 10;
                    ctx.strokeStyle = dataset.borderColor;
                    ctx.lineWidth = 2;
                    ctx.globalAlpha = 0.45;
                    ctx.beginPath();
                    ctx.arc(position.x, position.y, baseRadius + 7, 0, Math.PI * 2);
                    ctx.stroke();
                });
                ctx.restore();
            }
        };

        function initChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const data = getFilteredData();
            
            chart = new Chart(ctx, {
                type: 'scatter',
                data: { datasets: createDatasets(data) },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'nearest',
                        intersect: true
                    },
                    plugins: {
                        legend: { display: false },
                        modelLabels: {},
                        latestModelHighlight: {},
                        zoom: {
                            pan: {
                                enabled: true,
                                mode: 'xy',
                                threshold: 0
                            },
                            zoom: {
                                wheel: {
                                    enabled: true
                                },
                                pinch: {
                                    enabled: true
                                },
                                drag: {
                                    enabled: false
                                },
                                mode: 'xy'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(20, 20, 20, 0.95)',
                            titleColor: '#fff',
                            bodyColor: '#aaa',
                            borderColor: '#333',
                            borderWidth: 1,
                            cornerRadius: 2,
                            padding: 14,
                            titleFont: {
                                family: 'Space Grotesk',
                                size: 14,
                                weight: '600'
                            },
                            bodyFont: {
                                family: 'IBM Plex Mono',
                                size: 11
                            },
                            callbacks: {
                                title: (items) => items[0]?.raw?.model || '',
                                label: (item) => `Score: ${item.raw.y}`,
                                afterLabel: (item) => {
                                    const date = new Date(item.raw.x);
                                    return date.toLocaleDateString('fr-FR', { 
                                        month: 'long', 
                                        year: 'numeric' 
                                    });
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            min: defaultXMin,
                            max: defaultXMax,
                            time: {
                                unit: 'month',
                                displayFormats: { month: 'MMM yy' }
                            },
                            grid: {
                                color: '#2a2a2a',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#555',
                                font: { family: 'IBM Plex Mono', size: 10 }
                            },
                            title: {
                                display: true,
                                text: 'Date de sortie',
                                color: '#666',
                                font: { family: 'Space Grotesk', size: 11 }
                            }
                        },
                        y: {
                            min: defaultYMin,
                            max: defaultYMax,
                            grid: {
                                color: '#2a2a2a',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#555',
                                font: { family: 'IBM Plex Mono', size: 10 }
                            },
                            title: {
                                display: true,
                                text: 'Score Coding',
                                color: '#666',
                                font: { family: 'Space Grotesk', size: 11 }
                            }
                        }
                    },
                    animation: {
                        duration: 800,
                        easing: 'easeOutQuart'
                    }
                },
                plugins: [modelLabelPlugin, latestModelHighlightPlugin]
            });
            
            updateStats(data);
            buildLegend();
            setAxisInputs();
        }

        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                activeFilter = btn.dataset.filter;
                updateChart();
            });
        });

        document.getElementById('applyX').addEventListener('click', () => applyAxisScale('x'));
        document.getElementById('applyY').addEventListener('click', () => applyAxisScale('y'));
        document.getElementById('zoomIn').addEventListener('click', () => chart.zoom(1.2));
        document.getElementById('zoomOut').addEventListener('click', () => chart.zoom(0.8));
        document.getElementById('resetZoom').addEventListener('click', () => {
            chart.resetZoom();
            resetAxes();
            chart.update('none');
        });
        document.querySelectorAll('[data-range]').forEach(btn => {
            btn.addEventListener('click', () => applyDateRange(btn.dataset.range));
        });

        initChart();
    </script>
</body>
</html>
